<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>test XSRF</title>
    <script src="/static/js/ihome/jquery-1.12.4.min.js"></script>
</head>
<body>

<!--<form method="post">-->
    <!--<input type="hidden" name="_xsrf" value="a" id="post">-->
    <!--<input type="text" name="message">-->
    <!--<input type="submit" value="post">-->
<!--</form>-->

<!--<script type="text/javascript">-->
    <!--$(function(){-->
        <!--function getCookie(name){-->
            <!--var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");-->
            <!--return r ? r[1] : undefined;-->
        <!--}-->
        <!--alert("start")-->
        <!--$("#post").val(getCookie("_xsrf"))-->
        <!--alert($("#post").val())-->
        <!--alert("OK")-->
    <!--})-->
<!--</script>-->




<!--<a href="javascript:;" onclick="xsrfPost()">发送post请求</a>-->
<!--<script src="/static/js/ihome/jquery-1.12.4.min.js"></script>-->
<!--<script>-->
    <!--function getCookie(name){-->
        <!--var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");-->
        <!--return r ? r[1] : undefined;-->
    <!--}-->
    <!--function xsrfPost(){-->
        <!--var xsrf = getCookie("_xsrf");-->
        <!--var data = {-->
            <!--"_xsrf": xsrf,-->
            <!--"key1": "abc"-->
        <!--}-->
        <!--json_data = JSON.stringify(data)-->
        <!--&lt;!&ndash;$.post("/", data, function(data){&ndash;&gt;-->
            <!--&lt;!&ndash;alert("OK");&ndash;&gt;-->
        <!--&lt;!&ndash;})&ndash;&gt;-->
        <!--$.ajax({-->
            <!--url: "/",-->
            <!--type: "POST",-->
            <!--data: json_data,-->
            <!--contentType: "application/json",-->
            <!--dataType: "json",-->
            <!--success: function(data){-->
                <!--alert("OK");-->
            <!--}-->
        <!--})-->
    <!--}-->
<!--</script>-->

<a href="javascript:;" onclick="xsrfPost()">发送post请求</a>

<script>
    function getCookie(){
        alert("getCookie")
        var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
        return r? r[1] : undefined;
    }

    function xsrfPost(){
        alert("xsrfPost")
        var xsrf = getCookie("_xsrf");
        var data = {
            key1: 1,
            key2: 2
        }
        var json_data = JSON.stringify(data);
        $.ajax({
            url: "/",
            method: "POST",
            headers: {
                "X-XSRFToken": xsrf,
            },
            data: json_data,
            success: function(data){
                alert("OK");
            }
        })
    }
</script>
</body>
</html>